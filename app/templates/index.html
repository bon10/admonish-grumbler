{% extends "base.html" %}

{% block title %}
  admonish-grumbler
{% endblock %}

{% block content %}
<div class="columns">
  <div class="column is-one-quarter">
    <!-- å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <aside class="menu">
      <p class="menu-label">Menu</p>
      <ul class="menu-list">
        <li><a href="#">ãƒ›ãƒ¼ãƒ </a></li>
        <li><a href="#">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a></li>
        <li><a href="#">è¨­å®š</a></li>
      </ul>
    </aside>
  </div>
  <div class="column">
    <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="box">
      <form id="postForm">
        <div class="field">
          <div class="control">
            <textarea class="textarea" placeholder="ã•ã‚ã€æ„šç—´ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ã©ã‚“ã©ã‚“åãå‡ºã—ã¦ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ã‚‡ã†ï¼" name="content"></textarea>
          </div>
        </div>
        <div class="field">
          <div class="control">
            <button class="button is-primary" type="submit">æŠ•ç¨¿</button>
          </div>
        </div>
      </form>
    </div>
    <!-- æŠ•ç¨¿ãƒªã‚¹ãƒˆ -->
    <div class="container">
    {% for post in posts %}
    <article class="media box">
        <figure class="media-left">
            <p class="image is-64x64">
                <!-- replace with your avatar url -->
                <img src="{{ session["avatar"] }}" alt="User avatar">
            </p>
        </figure>
        <div class="media-content">
            <div class="content">
                <p>
                    <strong>{{ session["name"] }}</strong> <small>{{ post.timestamp }}</small>
                    <br>
                    {{ post.content }}
                </p>
            </div>
            <nav class="level is-mobile">
                <div class="level-left">
                    <a class="level-item">
                        <span class="icon is-small"><i class="fas fa-reply"></i></span>
                    </a>
                    <a class="level-item">
                        <span class="icon is-small"><i class="fas fa-retweet"></i></span>
                    </a>
                    <a class="level-item">
                        <span class="icon is-small"><i class="fas fa-heart"></i></span>
                    </a>
                </div>
            </nav>
        </div>
    </article>
    {% endfor %}
</div>
  </div>
</div>
<script>
  document.getElementById('postForm').addEventListener('submit', function(event) {
    event.preventDefault();
    var content = document.querySelector('textarea[name="content"]').value;
    fetch('/post', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ content: content }),
    })
    .then(function(response) {
      if (response.ok) {
        console.log('æ„šç—´ã®æŠ•ç¨¿ã«æˆåŠŸã—ã¾ã—ãŸğŸ¤“');
        document.querySelector('textarea[name="content"]').value = ''; // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
        // ã“ã“ã§æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ è¡¨ç¤ºã™ã‚‹ãªã©ã®å‡¦ç†ã‚’è¡Œã†
      } else {
        console.log('æ„šç—´ã®æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸğŸ˜­');
      }
    })
    .catch(function(error) {
      console.log('é€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
    });
  });
</script>
{% endblock %}
